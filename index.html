<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>¬∑ Top SMT ¬∑ </title>

  <!-- ===== Open Graph / Facebook ===== -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Top SMT (2020‚Äì2024)" />
  <meta property="og:description" content="Le top 2020‚Äì2024 de Pierre-Alexandre." />
  <meta property="og:url" content="https://peate1515.github.io/TOP/" />
  <meta property="og:image" content="https://peate1515.github.io/TOP/intro.png" />
  <meta property="og:image:secure_url" content="https://peate1515.github.io/TOP/intro.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <!-- ===== Twitter ===== -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Top SMT (2020‚Äì2024)" />
  <meta name="twitter:description" content="Le top 2020‚Äì2024 de l‚ÄôiTunes de Pierre-Alexandre. Plusieurs classements." />
  <meta name="twitter:image" content="https://peate1515.github.io/TOP/intro.png" />

  <link rel="stylesheet" href="site_cartes.css" />

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <!-- PapaParse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>

<body>
<div id="app">
  <!-- HERO -->
  <header id="hero" class="hero">
    <div class="hero-inner">
      <div class="hero-title-stack">
        <span class="hero-title-line">Top</span>
        <span class="hero-title-line">SMT</span>
      </div>
      <div class="hero-sub">
        Le top 2020-2024 de l'iTunes de Pierre-Alexandre
      </div>

      <!-- Fl√®che / incitation scroll -->
      <button id="hero-scroll" class="hero-scroll" type="button" aria-label="Voir la suite">
        <span class="hero-scroll-dot"></span>
        <span class="hero-scroll-arrow">‚åÑ</span>
      </button>
    </div>
  </header>

  <!-- CALQUE fond/*.png -->
  <div id="fond-layer" class="fond-layer"></div>

  <!-- SIGNET BAS-DROITE (nom du fond) -->
  <div id="fond-signet" class="fond-signet" aria-hidden="true">
    <span id="fond-signet-text">FOND</span>
  </div>

  <!-- CONTENU -->
  <main class="page">
    <!-- ONGLET -->
    <div class="tabs-sticky-wrapper" v-if="!loading && songsRaw.length">
      <nav class="tabs" aria-label="Modes de classement">
        <button
          v-for="mode in modes"
          :key="mode.id"
          type="button"
          :class="['tab-btn', { active: currentMode === mode.id }]"
          :aria-pressed="currentMode === mode.id ? 'true' : 'false'"
          @click="setMode(mode.id)"
        >
          <span class="tab-label">{{ mode.label }}</span>

          <!-- Bouton help s√©par√© (stop pour ne pas changer d‚Äôonglet) -->
          <span
            class="tab-help"
            role="button"
            tabindex="0"
            aria-label="Explication du classement"
            @click.stop="toggleHelp(mode.id)"
            @keydown.enter.stop="toggleHelp(mode.id)"
            @keydown.space.prevent.stop="toggleHelp(mode.id)"
          >
            ?
          </span>
        </button>
      </nav>
    </div>

    <!-- Tooltip (un seul global, mieux pour mobile/position) -->
    <div
      class="tooltip-layer"
      v-if="openHelpId"
      @click="closeHelp"
      aria-hidden="false"
    >
      <div class="tab-tooltip tab-tooltip--global" role="dialog" @click.stop>
        <div class="tab-tooltip-title">{{ helpTitle }}</div>
        <div class="tab-tooltip-body">{{ helpText }}</div>
        <button class="tab-tooltip-close" type="button" @click="closeHelp" aria-label="Fermer">
          ‚úï
        </button>
      </div>
    </div>

    <div v-if="loading" class="loading">
      Chargement du CSV‚Ä¶
    </div>

    <transition-group v-else name="cards" tag="div" class="grid">
      <div
        v-for="song in filteredSongs"
        :key="currentMode + '::' + song.id"
        class="song-card"
      >
        <!-- HEADER -->
        <div class="song-header">
          <div class="song-header-strip">
            <div class="song-strip-text">
              {{ displayRank(song) }}
            </div>
          </div>

          <div class="song-header-main">
            <div class="song-header-artist">
              <span class="song-artist-glitch">{{ song.artistUpper }}</span>
            </div>

            <div class="song-header-title">
              <span class="song-title-text">{{ song.titleUpper }}</span>
            </div>
          </div>
        </div>

        <!-- BODY -->
        <div class="song-body">
          <div class="song-info">
            <p class="song-comment" v-if="song.comment">
              {{ song.comment }}
            </p>

            <p class="song-meta">
              {{ song.album }}
              <span v-if="song.plays"> ‚Ä¢ {{ song.plays }} lectures</span>
              <span v-if="song.totalMinutes"> ‚Ä¢ {{ song.totalMinutes.toFixed(1) }} min √©cout√©es</span>
            </p>

            <div class="song-actions">
              <a
                v-if="song.youtubeUrl"
                class="play-button"
                :href="song.youtubeUrl"
                target="_blank"
                rel="noopener noreferrer"
              >
                ‚ñ∂ PLAY
              </a>
            </div>
          </div>

          <div class="song-cover-wrapper">
            <img
              v-if="song.artworkUrl"
              class="song-cover"
              :src="song.artworkUrl"
              :alt="`Pochette de ${song.title}`"
              loading="lazy"
              decoding="async"
            />
          </div>
        </div>
      </div>
    </transition-group>

    <footer class="footer">
      Site statique g√©n√©r√© √† partir du CSV üíõ‚ù§Ô∏è ‚Ä¢ Top limit√© √† 100 chansons par mode
    </footer>
  </main>
</div>

<!-- HERO SHRINK + scroll -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const hero = document.getElementById("hero");
  const body = document.body;

  const onScroll = () => {
    const y = window.scrollY || window.pageYOffset;
    const threshold = window.innerHeight * 0.18;

    if (y > threshold) {
      hero.classList.add("compact");
      body.classList.add("hero-compact");
      body.classList.add("tabs-fixed");
    } else {
      hero.classList.remove("compact");
      body.classList.remove("hero-compact");
      body.classList.remove("tabs-fixed");
    }
  };

  window.addEventListener("scroll", onScroll, { passive: true });
  onScroll();

  // Bouton fl√®che
  const btn = document.getElementById("hero-scroll");
  if (btn) {
    btn.addEventListener("click", () => {
      window.scrollTo({ top: Math.max(1, window.innerHeight * 0.25), behavior: "smooth" });
    });
  }
});
</script>

<script src="app.js"></script>
</body>
</html>
